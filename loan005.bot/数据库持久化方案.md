# 数据库持久化解决方案

## 方案一：使用 Zeabur Volume（推荐，简单）

### 配置步骤

1. **修改代码**（已完成）
   - 代码已支持通过 `DATA_DIR` 环境变量指定数据库存储路径

2. **在 Zeabur 配置 Volume**
   - 在 Zeabur 项目设置中
   - 找到 "Volumes" 或 "Storage" 选项
   - 添加 Volume：
     - **Mount Path**: `/data`
     - **Size**: 1GB（可根据需要调整）

3. **设置环境变量**
   ```
   DATA_DIR=/data
   ```

4. **重新部署**
   - 数据库文件将存储在持久化 Volume 中
   - 容器重启不会丢失数据

### 优点
- ✅ 简单易用，无需修改代码逻辑
- ✅ 数据完全本地化
- ✅ 性能好（本地文件系统）

### 缺点
- ⚠️ 备份需要手动操作
- ⚠️ 单容器限制（不能多实例）

---

## 方案二：使用 PostgreSQL（推荐，生产环境）

### 配置步骤

1. **在 Zeabur 添加 PostgreSQL 服务**
   - 在项目中添加 "PostgreSQL" 服务
   - Zeabur 会自动提供连接信息

2. **安装依赖**
   更新 `requirements.txt`：
   ```
   python-telegram-bot>=20.0
   pytz>=2023.3
   psycopg2-binary>=2.9.0
   ```

3. **修改代码使用 PostgreSQL**
   - 需要修改 `db_operations.py` 使用 PostgreSQL
   - 使用环境变量 `DATABASE_URL` 连接

4. **设置环境变量**
   ```
   DATABASE_URL=postgresql://user:password@host:port/dbname
   ```
   （Zeabur 会自动提供）

### 优点
- ✅ 数据持久化，自动备份
- ✅ 支持多实例部署
- ✅ 生产环境标准方案
- ✅ 更好的并发性能

### 缺点
- ⚠️ 需要修改代码
- ⚠️ 需要额外的数据库服务

---

## 方案三：使用 SQLite + 定期备份到云存储

### 配置步骤

1. **使用 Volume 存储数据库**（同方案一）

2. **添加定期备份脚本**
   - 定期将数据库文件备份到云存储（如 S3、Google Drive）
   - 可以使用 Zeabur 的 Cron Job 功能

### 优点
- ✅ 简单，无需修改代码
- ✅ 有备份保障

### 缺点
- ⚠️ 需要配置备份脚本
- ⚠️ 恢复需要手动操作

---

## 推荐方案

### 开发/测试环境
**使用方案一（Zeabur Volume）**
- 简单快速
- 满足基本需求

### 生产环境
**使用方案二（PostgreSQL）**
- 更可靠
- 支持扩展

---

## 当前配置（方案一）

代码已配置为支持 Volume，只需：

1. 在 Zeabur 添加 Volume（Mount Path: `/data`）
2. 设置环境变量：`DATA_DIR=/data`
3. 重新部署

数据库文件将存储在 `/data/loan_bot.db`，容器重启不会丢失。

