# 数据存储位置说明

## 📊 数据库文件存储位置

### 1. 本地开发环境

**默认位置：**
```
C:\Users\zhuanqian\Desktop\loan005.bot\loan_bot.db
```

**说明：**
- 数据库文件存储在项目根目录
- 文件名：`loan_bot.db`
- 这是 SQLite 数据库文件

### 2. Zeabur 部署环境

数据库存储位置取决于 `DATA_DIR` 环境变量的设置：

#### 情况 A：设置了 `DATA_DIR` 环境变量（推荐）

**环境变量：**
```
DATA_DIR=/data
```

**存储位置：**
```
/data/loan_bot.db
```

**说明：**
- 需要先在 Zeabur 配置 Volume（持久化存储）
- Volume Mount Path: `/data`
- 数据会持久化保存，容器重启不会丢失

#### 情况 B：没有设置 `DATA_DIR` 环境变量

**存储位置：**
```
/app/loan_bot.db
```

**说明：**
- 使用默认路径（项目根目录）
- ⚠️ **容器重启会丢失数据**
- 适合测试环境

## 🔄 数据库更新机制

### 自动更新

当程序启动时，`init_db.py` 会自动：

1. **检查表是否存在**
   - 如果不存在，创建所有表
   - 如果存在，检查列是否完整

2. **自动添加缺失的列**
   - 如果表已存在但缺少某些列（如 `liquid_flow`）
   - 会自动使用 `ALTER TABLE` 添加缺失的列

3. **初始化默认数据**
   - 如果 `financial_data` 表为空，插入初始数据

### 更新位置

**数据库更新发生在：**
- 程序启动时（`main.py` 调用 `init_db.init_database()`）
- 数据库文件所在位置（见上面的存储位置说明）

## 💾 代码更新存储位置

### 1. 本地代码

**位置：**
```
C:\Users\zhuanqian\Desktop\loan005.bot\
```

**文件：**
- 所有 Python 源代码文件
- 配置文件（`requirements.txt`, `Procfile` 等）

### 2. Git 仓库（需要提交）

**提交命令：**
```bash
cd C:\Users\zhuanqian\Desktop\loan005.bot

# 添加所有修改的文件
git add .

# 提交
git commit -m "修复数据库表结构和所有问题"

# 推送到远程仓库
git push
```

**存储位置：**
- GitHub / GitLab / 其他 Git 托管平台
- 远程仓库地址（你配置的 `origin`）

### 3. Zeabur 部署环境

**代码来源：**
- Zeabur 从 Git 仓库自动拉取代码
- 存储在容器中的 `/app/` 目录

**代码位置：**
```
/app/main.py
/app/init_db.py
/app/db_operations.py
/app/handlers/
/app/callbacks/
/app/utils/
```

## 📋 当前修复的文件

### 数据库相关修复

**文件：** `init_db.py`
- ✅ 添加了 `liquid_flow` 列
- ✅ 添加了 `company_expenses` 列
- ✅ 添加了 `other_expenses` 列
- ✅ 添加了自动迁移逻辑

**存储位置：**
- 本地：`C:\Users\zhuanqian\Desktop\loan005.bot\init_db.py`
- Git：需要提交到远程仓库
- Zeabur：部署后会在 `/app/init_db.py`

### 数据库文件更新

**更新时机：**
- 程序启动时自动执行
- 数据库文件位置取决于 `DATA_DIR` 环境变量

**更新内容：**
- 在 `daily_data` 表中添加缺失的列
- 不影响现有数据

## ⚙️ 配置建议

### 开发环境（本地）

**不需要设置 `DATA_DIR`**
- 数据库存储在项目目录
- 方便查看和调试

### 生产环境（Zeabur）

**推荐配置：**

1. **在 Zeabur 添加 Volume**
   - Mount Path: `/data`
   - Size: 1GB（可根据需要调整）

2. **设置环境变量**
   ```
   DATA_DIR=/data
   ```

3. **重新部署**
   - 数据库会存储在持久化 Volume 中
   - 容器重启不会丢失数据

## 🔍 查看数据库位置

### 本地环境

```bash
# Windows PowerShell
cd C:\Users\zhuanqian\Desktop\loan005.bot
dir loan_bot.db
```

### Zeabur 环境

在代码中添加调试信息：
```python
import os
print(f"DATA_DIR: {os.getenv('DATA_DIR', '未设置（使用默认路径）')}")
print(f"数据库文件: {DB_NAME}")
```

## 📝 重要提示

1. **数据库文件不会提交到 Git**
   - `.gitignore` 中已排除 `*.db` 文件
   - 每个环境有独立的数据库文件

2. **代码必须提交到 Git**
   - 所有 `.py` 文件需要提交
   - Zeabur 从 Git 仓库拉取代码

3. **数据库更新是自动的**
   - 不需要手动执行 SQL
   - 程序启动时自动检查和更新

4. **数据持久化**
   - 使用 Volume 可以持久化数据
   - 不使用 Volume 会丢失数据（容器重启时）

